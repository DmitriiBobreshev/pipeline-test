parameters:
- name: 'rootFolderPrefix'
  type: string

steps:
- task: FtpUpload@2
  displayName: 'Single file, backslashes, dirty'
  inputs:
    serverEndpoint: test_ftp
    rootDirectory: src/ftp-upload/${{ parameters.rootFolderPrefix }}/Folder1
    filePatterns: 'Folder With Space\Commands1.txt'
    remoteDirectory: '\site\wwwroot'
    trustSSL: true
  condition: and(succeeded(), contains(variables['Agent.Os'], 'Windows'))
  retryCountOnTaskFailure: 8

- task: FtpUpload@2
  displayName: 'Single file, backslashes, clean'
  inputs:
    serverEndpoint: test_ftp
    rootDirectory: src/ftp-upload/${{ parameters.rootFolderPrefix }}/Folder1
    filePatterns: 'Folder With Space\Commands1.txt'
    remoteDirectory: '\site\wwwroot'
    clean: true
    trustSSL: true
  condition: and(succeeded(), contains(variables['Agent.Os'], 'Windows'))
  retryCountOnTaskFailure: 8

- task: FtpUpload@2
  displayName: 'Single file, forward slashes, dirty'
  inputs:
    serverEndpoint: test_ftp
    rootDirectory: src/ftp-upload/${{ parameters.rootFolderPrefix }}/Folder1
    filePatterns: 'Folder With Space/Commands1.txt'
    remoteDirectory: /site/wwwroot
    trustSSL: true
  retryCountOnTaskFailure: 8

- task: FtpUpload@2
  displayName: 'Single file, forward slashes, clean'
  inputs:
    serverEndpoint: test_ftp
    rootDirectory: src/ftp-upload/${{ parameters.rootFolderPrefix }}/Folder1
    filePatterns: 'Folder With Space/Commands1.txt'
    remoteDirectory: /site/wwwroot
    clean: true
    trustSSL: true
  retryCountOnTaskFailure: 8

- task: FtpUpload@2
  displayName: 'File pattern, backslashes, dirty'
  inputs:
    serverEndpoint: test_ftp
    rootDirectory: src/ftp-upload/${{ parameters.rootFolderPrefix }}/Folder1
    filePatterns: 'Folder With Space\*.txt'
    remoteDirectory: '\site\wwwroot'
    trustSSL: true
  condition: and(succeeded(), contains(variables['Agent.Os'], 'Windows'))
  retryCountOnTaskFailure: 8

- task: FtpUpload@2
  displayName: 'File pattern, backslashes, clean'
  inputs:
    serverEndpoint: test_ftp
    rootDirectory: src/ftp-upload/${{ parameters.rootFolderPrefix }}/Folder1
    filePatterns: 'Folder With Space\*.txt'
    remoteDirectory: '\site\wwwroot'
    clean: true
    trustSSL: true
  condition: and(succeeded(), contains(variables['Agent.Os'], 'Windows'))
  retryCountOnTaskFailure: 8

- task: FtpUpload@2
  displayName: 'File pattern, forward slashes, dirty'
  inputs:
    serverEndpoint: test_ftp
    rootDirectory: src/ftp-upload/${{ parameters.rootFolderPrefix }}/Folder1
    filePatterns: 'Folder With Space/*.txt'
    remoteDirectory: /site/wwwroot
    trustSSL: true
  retryCountOnTaskFailure: 8

- task: FtpUpload@2
  displayName: 'File pattern, forward slashes, clean'
  inputs:
    serverEndpoint: test_ftp
    rootDirectory: src/ftp-upload/${{ parameters.rootFolderPrefix }}/Folder1
    filePatterns: 'Folder With Space/*.txt'
    remoteDirectory: /site/wwwroot
    clean: true
    trustSSL: true
  retryCountOnTaskFailure: 8

- template: create-dummy-files.yml
  parameters:
    fileCount: 10
    fileName: "largefile"
    fileSize: 524288000

- task: FtpUpload@2
  displayName: 'FTP Upload: 10 large files'
  inputs:
    serverEndpoint: test_ftp
    rootDirectory: ''
    filePatterns: 'largefile*.txt'
    remoteDirectory: '/upload/FtpUpload-${{ parameters.rootFolderPrefix }}/'
    trustSSL: true

- task: FtpUpload@2
  displayName: 'FTP Upload: Hack to delete contents'
  inputs:
    serverEndpoint: test_ftp
    rootDirectory: 'src/ftp-upload/${{ parameters.rootFolderPrefix }}/Folder1/Folder With Space'
    remoteDirectory: '/upload/FtpUpload-clone/'
    trustSSL: true
    clean: true
  retryCountOnTaskFailure: 8

- task: FtpUpload@2
  displayName: 'FTPS, multiple patterns, dirty, preserve paths'
  inputs:
    serverEndpoint: 'test_ftp'
    rootDirectory: '$(Build.SourcesDirectory)/src/ftp-upload/${{ parameters.rootFolderPrefix }}/'
    filePatterns: |
      **/*1.txt
      **/*2.txt
    remoteDirectory: /site/wwwroot
    trustSSL: true
    preservePaths: true
  retryCountOnTaskFailure: 8

- task: FtpUpload@2
  displayName: 'FTPS, multiple patterns, clean, preserve paths'
  inputs:
    serverEndpoint: 'test_ftp'
    rootDirectory: '$(Build.SourcesDirectory)/src/ftp-upload/${{ parameters.rootFolderPrefix }}/'
    filePatterns: |
      **/*1.txt
      **/*2.txt
    remoteDirectory: /site/wwwroot
    clean: true
    trustSSL: true
    preservePaths: true
  retryCountOnTaskFailure: 8

- template: create-dummy-files.yml
  parameters:
    fileCount: 1000
    fileName: "small"
    fileSize: 4096

- task: FtpUpload@2
  displayName: 'FTP Upload: 1000 small files'
  inputs:
    serverEndpoint: 'test_ftp'
    rootDirectory: ''
    filePatterns: 'small*.txt'
    remoteDirectory: '/upload/FtpUpload-${{ parameters.rootFolderPrefix }}/'
    trustSSL: true
    clean: true
  retryCountOnTaskFailure: 8
